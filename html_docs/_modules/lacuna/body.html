<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>lacuna.body &mdash; Monty Lacuna 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Monty Lacuna 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Monty Lacuna 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for lacuna.body</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">functools</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">lacuna.buildings</span>
<span class="kn">import</span> <span class="nn">lacuna.bc</span>
<span class="kn">from</span> <span class="nn">lacuna.exceptions</span> <span class="kn">import</span> \
    <span class="n">NoSuchBuildingError</span>

<span class="k">class</span> <span class="nc">Body</span><span class="p">(</span><span class="n">lacuna</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">LacunaObject</span><span class="p">):</span>
<div class="viewcode-block" id="Body"><a class="viewcode-back" href="../../body.html#lacuna.body.Body">[docs]</a>    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        id                          &quot;id-goes-here&quot;,</span>
<span class="sd">        x                           -4,</span>
<span class="sd">        y                           10,</span>
<span class="sd">        star_id                     &quot;id-goes-here&quot;,</span>
<span class="sd">        star_name                   &quot;Sol&quot;,</span>
<span class="sd">        orbit                       3,</span>
<span class="sd">        type                        &quot;habitable planet&quot;,</span>
<span class="sd">        name                        &quot;Earth&quot;,</span>
<span class="sd">        image                       &quot;p13&quot;,</span>
<span class="sd">        size                        67,</span>
<span class="sd">        water                       900,</span>
<span class="sd">        ore                         {   &quot;gold&quot; : 3399,</span>
<span class="sd">                                        &quot;bauxite&quot; : 4000,</span>
<span class="sd">                                        etc</span>
<span class="sd">                                    },</span>
<span class="sd">        empire                      { # only exists if the body is inhabited</span>
<span class="sd">                                        &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                        &quot;name&quot; : &quot;Earthlings&quot;,</span>
<span class="sd">                                        &quot;alignment&quot; : &quot;ally&quot;,   # can be &#39;ally&#39;,&#39;self&#39;, or &#39;hostile&#39;</span>
<span class="sd">                                        &quot;is_isolationist&quot; : 1</span>
<span class="sd">                                    },</span>
<span class="sd">        station                     { # only shows up if this planet is under the influence of a space station</span>
<span class="sd">                                        &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                        &quot;x&quot; : 143,</span>
<span class="sd">                                        &quot;y&quot; : -27,</span>
<span class="sd">                                        &quot;name&quot; : &quot;The Death Star&quot;</span>
<span class="sd">                                    },</span>
<span class="sd">        ### The following will only be set if you own the body in question.</span>
<span class="sd">        ### </span>
<span class="sd">        needs_surface_refresh       1,  # indicates that the client needs to call get_buildings() because something has changed</span>
<span class="sd">        building_count              7,</span>
<span class="sd">        plots_available             60,</span>
<span class="sd">        happiness                   3939,</span>
<span class="sd">        happiness_hour              25,</span>
<span class="sd">        unhappy_date                &quot;01 13 2014 16:11:21 +0600&quot;,  # Only given if happiness is below zero</span>
<span class="sd">        propaganda_boost            20,</span>
<span class="sd">        food_stored                 33329,</span>
<span class="sd">        food_capacity               40000,</span>
<span class="sd">        food_hour                   229,</span>
<span class="sd">        energy_stored               39931,</span>
<span class="sd">        energy_capacity             43000,</span>
<span class="sd">        energy_hour                 391,</span>
<span class="sd">        ore_hour                    284,</span>
<span class="sd">        ore_capacity                35000,</span>
<span class="sd">        ore_stored                  1901,</span>
<span class="sd">        waste_hour                  933,</span>
<span class="sd">        waste_stored                9933,</span>
<span class="sd">        waste_capacity              13000,</span>
<span class="sd">        water_stored                9929,</span>
<span class="sd">        water_hour                  295,</span>
<span class="sd">        water_capacity              51050,   </span>
<span class="sd">        skip_incoming_ships         0,      # if set, then the following incoming data is missing.</span>
<span class="sd">        num_incoming_enemy          10,     # total number of incoming foreign ships</span>
<span class="sd">        num_incoming_ally           1,      # total number of incoming allied ships</span>
<span class="sd">        num_incoming_own            0,      # total number of incoming own ships from other colonies</span>
<span class="sd">        incoming_enemy_ships         [</span>
<span class="sd">                                        # will only be included when enemy ships are coming to </span>
<span class="sd">                                        # your planet (only the first 20 will be shown)</span>
<span class="sd">                                        {</span>
<span class="sd">                                            &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                            &quot;date_arrives&quot; : &quot;01 31 2010 13:09:05 +0600&quot;,</span>
<span class="sd">                                            &quot;is_own&quot; : 1,                                   # is this from one of our own planets</span>
<span class="sd">                                            &quot;is_ally&quot; : 1                                   # is this from a planet within our alliance</span>
<span class="sd">                                        },</span>
<span class="sd">                                        etc</span>
<span class="sd">                                    ],</span>
<span class="sd">        incoming_ally_ships         [</span>
<span class="sd">                                        # will only be included when allied ships are coming to </span>
<span class="sd">                                        # your planet (only the first 10 will be shown)</span>
<span class="sd">                                        etc</span>
<span class="sd">                                    ],</span>
<span class="sd">        incoming_own_ships          [</span>
<span class="sd">                                        # will only be included when ships from your other </span>
<span class="sd">                                        # colonies are coming to your planet (only the first </span>
<span class="sd">                                        # 10 will be shown)</span>
<span class="sd">                                        etc  </span>
<span class="sd">                                    ],</span>
<span class="sd">        ### The following will only be set if the body is a space station.</span>
<span class="sd">        ### </span>
<span class="sd">        alliance                    { </span>
<span class="sd">                                        &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                        &quot;name&quot; : &quot;Imperial Empire&quot; </span>
<span class="sd">                                    },</span>
<span class="sd">        influence                   {</span>
<span class="sd">                                        &quot;total&quot; : 0,</span>
<span class="sd">                                        &quot;spent&quot; : 0</span>
<span class="sd">                                    }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s">&#39;body&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span> <span class="n">attrs</span><span class="p">:</span><span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="n">client</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_id</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

        <span class="c">### &#39;image&#39; == &#39;p16-1&#39; or so.  The &quot;-1&quot; indicates the size of the </span>
        <span class="c">### image, which will depend on the size of the planet, and we don&#39;t </span>
        <span class="c">### care about that at all.  Just get the planet type, the &quot;p16&quot;, out </span>
        <span class="c">### of that.</span>
        <span class="k">if</span> <span class="s">&#39;image&#39;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">mymatch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="s">&quot;^(p\d+)&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">mymatch</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;surface_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mymatch</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_status_attr</span><span class="p">(</span> <span class="n">attrs</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_body_status</span><span class="p">(</span> <span class="n">func</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Decorator.</span>
<span class="sd">        Much like LacunaObject.set_empire_status.  Most of the Body server </span>
<span class="sd">        methods return both empire status and body status.  So we&#39;ll still </span>
<span class="sd">        decorate with LacunaObject.set_empire_status to get the empire status, </span>
<span class="sd">        but we&#39;ll also decorate with this to set the body status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">### We _must_ check for &#39;status&#39; before checking for body.</span>
            <span class="c">###</span>
            <span class="c">### In every case that includes a &#39;status&#39; key, that&#39;s the status </span>
            <span class="c">### dict we&#39;re looking for.</span>
            <span class="c">###</span>
            <span class="c">### But in at least one server method (get_buildings), there&#39;s a </span>
            <span class="c">### &#39;body&#39; key that is NOT the status dict we&#39;re looking for.  In </span>
            <span class="c">### other cases (get_status), the &#39;body&#39; key IS the status dict </span>
            <span class="c">### we&#39;re looking for.</span>
            <span class="c">### So check &#39;status&#39; first, then check &#39;body&#39;.</span>
            <span class="n">mydict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;body&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]:</span>
                    <span class="n">mydict</span> <span class="o">=</span> <span class="n">rv</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">][</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
                    <span class="k">del</span><span class="p">(</span> <span class="n">rv</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">][</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;body&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="p">:</span>
                <span class="n">mydict</span> <span class="o">=</span> <span class="n">rv</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span>
                <span class="k">del</span><span class="p">(</span> <span class="n">rv</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">rv</span>
        <span class="k">return</span> <span class="n">inner</span>

    <span class="nd">@_set_body_status</span>
    <span class="k">def</span> <span class="nf">_set_status_attr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">my_attrs</span><span class="p">:</span><span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Fake up a status dict in the expected format, so the </span>
<span class="sd">        _set_body_status decorator can properly set our attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;body&#39;</span><span class="p">:</span> <span class="n">my_attrs</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">status</span>


<span class="k">class</span> <span class="nc">MyBody</span><span class="p">(</span><span class="n">Body</span><span class="p">):</span></div>
<div class="viewcode-block" id="MyBody"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody">[docs]</a>
    <span class="sd">&quot;&quot;&quot; A MyBody object is a planet or space station owned by the current </span>
<span class="sd">    empire.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        id                  &quot;id-goes-here&quot;,</span>
<span class="sd">        x                   -4,</span>
<span class="sd">        y                   10,</span>
<span class="sd">        star_id             &quot;id-goes-here&quot;,</span>
<span class="sd">        star_name           &quot;Sol&quot;,</span>
<span class="sd">        orbit               3,</span>
<span class="sd">        type                &quot;habitable planet&quot;,</span>
<span class="sd">        name                &quot;Earth&quot;,</span>
<span class="sd">        image               &quot;p13&quot;,</span>
<span class="sd">        size                67,</span>
<span class="sd">        water               900,</span>
<span class="sd">        ore                 {</span>
<span class="sd">                                &quot;gold&quot; : 3399,</span>
<span class="sd">                                &quot;bauxite&quot; : 4000,</span>
<span class="sd">                                etc</span>
<span class="sd">                            },</span>
<span class="sd">        empire                  {</span>
<span class="sd">                                    &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                    &quot;name&quot; : &quot;Earthlings&quot;,</span>
<span class="sd">                                    &quot;alignment&quot; : &quot;ally&quot;,   # can be &#39;ally&#39;,&#39;self&#39;, or &#39;hostile&#39;</span>
<span class="sd">                                    &quot;is_isolationist&quot; : 1</span>
<span class="sd">                                },</span>
<span class="sd">        station                 { # only shows up if this planet is under the influence of a space station</span>
<span class="sd">                                    &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                    &quot;x&quot; : 143,</span>
<span class="sd">                                    &quot;y&quot; : -27,</span>
<span class="sd">                                    &quot;name&quot; : &quot;The Death Star&quot;</span>
<span class="sd">                                },</span>
<span class="sd">        needs_surface_refresh   1, # indicates that the client needs to call get_buildings() because something has changed</span>
<span class="sd">        building_count          7,</span>
<span class="sd">        plots_available         0,</span>
<span class="sd">        happiness               3939,</span>
<span class="sd">        happiness_hour          25,</span>
<span class="sd">        unhappy_date            &quot;01 13 2014 16:11:21 +0600&quot;,  # Only given if happiness is below zero</span>
<span class="sd">        propaganda_boost        20,</span>
<span class="sd">        food_stored             33329,</span>
<span class="sd">        food_capacity           40000,</span>
<span class="sd">        food_hour               229,</span>
<span class="sd">        energy_stored           39931,</span>
<span class="sd">        energy_capacity         43000,</span>
<span class="sd">        energy_hour             391,</span>
<span class="sd">        ore_hour                284,</span>
<span class="sd">        ore_capacity            35000,</span>
<span class="sd">        ore_stored              1901,</span>
<span class="sd">        waste_hour              ,</span>
<span class="sd">        waste_stored            9933,</span>
<span class="sd">        waste_capacity          13000,</span>
<span class="sd">        water_stored            9929,</span>
<span class="sd">        water_hour              295,</span>
<span class="sd">        water_capacity          51050,   </span>
<span class="sd">        skip_incoming_ships     0,   # if set, then the following incoming data is missing.</span>
<span class="sd">        num_incoming_enemy      10,   # total number of incoming foreign ships</span>
<span class="sd">        num_incoming_ally       1,     # total number of incoming allied ships</span>
<span class="sd">        num_incoming_own : 0,   # total number of incoming own ships from other colonies</span>
<span class="sd">        incoming_enemy_ships    [ # will only be included when enemy ships are coming to your planet (only the first 20 will be shown)</span>
<span class="sd">                                    {</span>
<span class="sd">                                        &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                        &quot;date_arrives&quot; : &quot;01 31 2010 13:09:05 +0600&quot;,</span>
<span class="sd">                                        &quot;is_own&quot; : 1,   # is this from one of our own planets</span>
<span class="sd">                                        &quot;is_ally&quot; : 1   # is this from a planet within our alliance</span>
<span class="sd">                                    },</span>
<span class="sd">                                    etc</span>
<span class="sd">                                ],</span>
<span class="sd">        incoming_ally_ships     [ # will only be included when allied ships are coming to your planet (only the first 10 will be shown)</span>
<span class="sd">                                    etc</span>
<span class="sd">                                ],</span>
<span class="sd">        incoming_own_ships      [ # will only be included when ships from your other colonies are coming to your planet (only the first 10 will be shown)</span>
<span class="sd">                                    etc  </span>
<span class="sd">                                ],</span>
<span class="sd">        ### The following will only be set if the body is a space station.</span>
<span class="sd">        ### </span>
<span class="sd">        alliance                { </span>
<span class="sd">                                    &quot;id&quot; : &quot;id-goes-here&quot;,</span>
<span class="sd">                                    &quot;name&quot; : &quot;Imperial Empire&quot; </span>
<span class="sd">                                },</span>
<span class="sd">        influence               {</span>
<span class="sd">                                    &quot;total&quot; : 0,</span>
<span class="sd">                                    &quot;spent&quot; : 0</span>
<span class="sd">                                }</span>
<span class="sd">        ### The *building dict*s mentioned below are dicts containing the </span>
<span class="sd">        ### information represented by a building.MyBuilding&#39;s attributes.</span>
<span class="sd">        buildings_id            {</span>
<span class="sd">                                    building_id_1 = { building dict },</span>
<span class="sd">                                    building_id_2 = { building dict },</span>
<span class="sd">                                    etc,</span>
<span class="sd">                                }</span>
<span class="sd">        buildings_name          {</span>
<span class="sd">                                    &#39;Apple Orchard&#39; = [</span>
<span class="sd">                                        ### These are lists, as we&#39;re going to </span>
<span class="sd">                                        ### have multiple instances of certain </span>
<span class="sd">                                        ### building types.</span>
<span class="sd">                                        { building dict },</span>
<span class="sd">                                        { building dict },</span>
<span class="sd">                                        etc</span>
<span class="sd">                                    ],</span>
<span class="sd">                                    &#39;Space Port&#39; = [</span>
<span class="sd">                                        { building dict },</span>
<span class="sd">                                        { building dict },</span>
<span class="sd">                                        etc</span>
<span class="sd">                                    ],</span>
<span class="sd">                                    etc</span>
<span class="sd">                                }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span> <span class="n">body_id</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">attrs</span><span class="p">:</span><span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">):</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body_id</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="n">client</span><span class="p">,</span> <span class="n">attrs</span> <span class="p">)</span>
        <span class="c">### I want self to start out populated, which would require a call to </span>
        <span class="c">### get_status().  But since all the other methods also require a </span>
        <span class="c">### status block, I can call _set_buildings() instead (which is itself </span>
        <span class="c">### calling get_buildings()) and get both the status data and the </span>
        <span class="c">### building data in a single shot.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_buildings</span><span class="p">()</span>

    <span class="nd">@Body._set_body_status</span>
    <span class="nd">@lacuna.bc.LacunaObject.call_body_meth</span>
    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">blarg</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<div class="viewcode-block" id="MyBody.get_status"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.get_status">[docs]</a>        <span class="sd">&quot;&quot;&quot; Gets status of the current body.</span>
<span class="sd">        This both returns a dict of status information, and sets the MyBody </span>
<span class="sd">        object&#39;s using that dict.  Since every call to every method in this </span>
<span class="sd">        class also sets those attributes, there should never be a need to call </span>
<span class="sd">        this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@Body._set_body_status</span></div>
    <span class="nd">@lacuna.bc.LacunaObject.call_body_meth</span>
    <span class="k">def</span> <span class="nf">get_buildings</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<div class="viewcode-block" id="MyBody.get_buildings"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.get_buildings">[docs]</a>        <span class="sd">&quot;&quot;&quot; Returns dict with key &#39;buildings&#39;.  This dict is keyed off </span>
<span class="sd">        building IDs.  Values are building dicts as documented by </span>
<span class="sd">        get_buildable().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_building_id</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span><span class="nb">int</span> <span class="p">):</span></div>
<div class="viewcode-block" id="MyBody.get_building_id"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.get_building_id">[docs]</a>        <span class="sd">&quot;&quot;&quot; Given a building&#39;s ID, returns the object for that building.&quot;&quot;&quot;</span>
        <span class="n">bldg_str</span> <span class="o">=</span> <span class="s">&quot;lacuna.buildings.{}( self.client, self.body_id, id )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">classname</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">bldg_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_building_coords</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span> <span class="p">):</span></div>
<div class="viewcode-block" id="MyBody.get_building_coords"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.get_building_coords">[docs]</a>        <span class="sd">&quot;&quot;&quot; Given a building&#39;s coordinates, returns the object for that building.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">bid</span><span class="p">,</span> <span class="n">bdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildings_id</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">bdict</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">x</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">bdict</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
                <span class="n">classname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;^/(\w+)&quot;</span><span class="p">,</span> <span class="s">&quot;\g&lt;1&gt;&quot;</span><span class="p">,</span> <span class="n">bdict</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">bldg_str</span> <span class="o">=</span> <span class="s">&quot;lacuna.buildings.{}( self.client, self.body_id, bid )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">classname</span> <span class="p">)</span>
                <span class="n">mybldg</span> <span class="o">=</span>  <span class="nb">eval</span><span class="p">(</span><span class="n">bldg_str</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">mybldg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSuchBuildingError</span><span class="p">(</span><span class="s">&quot;No building was found at ({},{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_new_building</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">:</span><span class="nb">str</span> <span class="p">):</span></div>
<div class="viewcode-block" id="MyBody.get_new_building"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.get_new_building">[docs]</a>        <span class="sd">&quot;&quot;&quot; Returns a building object of the requested classname.</span>
<span class="sd">        This is a Potential building.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bldg_str</span> <span class="o">=</span> <span class="s">&quot;lacuna.buildings.{}( self.client, self.body_id )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">classname</span> <span class="p">)</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">bldg_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_buildings</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span></div>
        <span class="sd">&quot;&quot;&quot; Sets self.buildings_id and self.buildings_name.</span>
<span class="sd">        Called upon instantiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">### Instantiating a building object spends an RPC calling that </span>
        <span class="c">### building&#39;s view() method.  We absolutely do not want to do that </span>
        <span class="c">### for every building here, so leave both buildings_id and </span>
        <span class="c">### buildings_name as dicts.</span>

        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_buildings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buildings_id</span> <span class="o">=</span> <span class="n">rv</span><span class="p">[</span><span class="s">&#39;buildings&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buildings_name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">bldg_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildings_id</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">bldg_dict</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildings_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">buildings_name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c">### Since we&#39;re causing this new dict to be keyed off name, we </span>
            <span class="c">### have to make sure that the id is part of the dict now (it </span>
            <span class="c">### wasn&#39;t before, because it was the key).</span>
            <span class="n">bldg_dict</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildings_name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">bldg_dict</span> <span class="p">)</span>

    <span class="nd">@Body._set_body_status</span>
    <span class="nd">@lacuna.bc.LacunaObject.call_body_meth</span>
    <span class="k">def</span> <span class="nf">repair_list</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">building_ids_to_repair</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<div class="viewcode-block" id="MyBody.repair_list"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.repair_list">[docs]</a>        <span class="sd">&quot;&quot;&quot; Repairs all buildings indicated by ID in the passed-in list.</span>

<span class="sd">        CHECK</span>

<span class="sd">        Per the API docs, this should return a dict including key &#39;buildings&#39;, </span>
<span class="sd">        itself a dict of id -&gt; building_dict.  This &#39;buildings&#39; dict will only </span>
<span class="sd">        contain buildings passed in building_ids_to_repair.</span>

<span class="sd">        I haven&#39;t got any broken buildings handy to actually test this retval, </span>
<span class="sd">        so I haven&#39;t been able to verify the paragraph above yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@Body._set_body_status</span></div>
    <span class="nd">@lacuna.bc.LacunaObject.call_body_meth</span>
    <span class="k">def</span> <span class="nf">rearrange_buildings</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">arrangement</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<div class="viewcode-block" id="MyBody.rearrange_buildings"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.rearrange_buildings">[docs]</a>        <span class="sd">&quot;&quot;&quot; Moves one or more buildings to a new spot on the planet surface.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            - arrangement -- A list of dicts describing your new surface arrangement</span>

<span class="sd">                &gt;&gt;&gt; </span>
<span class="sd">                [</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;id&#39;: integer ID of the building to move,</span>
<span class="sd">                        &#39;x&#39;:  integer X coordinate to move to,</span>
<span class="sd">                        &#39;y&#39;:  integer y coordinate to move to,</span>
<span class="sd">                    },</span>
<span class="sd">                    { another building to move, same format as above },</span>
<span class="sd">                    etc</span>
<span class="sd">                ]</span>

<span class="sd">        Returns a dict including the key &#39;moved&#39;, which is a list of dicts of </span>
<span class="sd">        buildings that were moved.  This returned list is identical to the </span>
<span class="sd">        list you passed in except it also contains a &#39;name&#39; key containing the </span>
<span class="sd">        human-readable name of the moved building.</span>

<span class="sd">        Attempting to make an illegal move (moving a building out of -5..5 </span>
<span class="sd">        bounds, moving it on top of another building, moving the PCC at all, </span>
<span class="sd">        etc) raises ServerError 1013 and no moves are made, even if others in </span>
<span class="sd">        the list were legal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@Body._set_body_status</span></div>
    <span class="nd">@lacuna.bc.LacunaObject.call_body_meth</span>
    <span class="k">def</span> <span class="nf">get_buildable</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<div class="viewcode-block" id="MyBody.get_buildable"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.get_buildable">[docs]</a>        <span class="sd">&quot;&quot;&quot; Get a list of buildings that can be built on the indicated </span>
<span class="sd">        coords.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            - x -- Required integer X coordinate where you want to place the building</span>
<span class="sd">            - y -- Required integer Y coordinate where you want to place the building</span>
<span class="sd">            - tag -- Optional string to limit what gets returned.</span>

<span class="sd">        Tags are analogous to the buttons and drop-down box that appear in the </span>
<span class="sd">        build menu in the browser client, such as Now, Later, Happiness, Ore, </span>
<span class="sd">        Resources, etc.</span>

<span class="sd">        A complete list of tags can be found at:</span>
<span class="sd">            https://us1.lacunaexpanse.com/api/Body.html#get_buildable_%28_session_id%2C_body_id%2C_x%2C_y%2C_tag_%29</span>

<span class="sd">        Sending an invalid tag is not an error, it simply returns zero </span>
<span class="sd">        results.</span>

<span class="sd">        Returns a dict that includes the key &#39;buildable&#39;, which is a list of </span>
<span class="sd">        dicts keyed off the human-readable building name:</span>
<span class="sd">            &gt;&gt;&gt; </span>
<span class="sd">            [</span>
<span class="sd">                &#39;Water Purification Plant&#39;: {</span>
<span class="sd">                    &#39;build&#39;: {</span>
<span class="sd">                        &#39;can&#39;: 1,</span>
<span class="sd">                        &#39;cost&#39;: {   &#39;energy&#39;: &#39;64&#39;,</span>
<span class="sd">                                    &#39;food&#39;: &#39;72&#39;,</span>
<span class="sd">                                    &#39;ore&#39;: &#39;88&#39;,</span>
<span class="sd">                                    &#39;time&#39;: &#39;15&#39;,</span>
<span class="sd">                                    &#39;waste&#39;: &#39;16&#39;,</span>
<span class="sd">                                    &#39;water&#39;: &#39;8&#39;</span>
<span class="sd">                                },</span>
<span class="sd">                        &#39;no_plot_use&#39;: &#39;&#39;,</span>
<span class="sd">                        &#39;reason&#39;: &#39;&#39;,</span>
<span class="sd">                        &#39;tags&#39;: [&#39;Resources&#39;, &#39;Water&#39;, &#39;Now&#39;]</span>
<span class="sd">                    },</span>
<span class="sd">                    &#39;image&#39;: &#39;waterpurification0&#39;,</span>
<span class="sd">                    &#39;production&#39;: {</span>
<span class="sd">                        &#39;energy_capacity&#39;: 0,</span>
<span class="sd">                        &#39;energy_hour&#39;: &#39;-3&#39;,</span>
<span class="sd">                        &#39;food_capacity&#39;: 0,</span>
<span class="sd">                        &#39;food_hour&#39;: &#39;-1&#39;,</span>
<span class="sd">                        &#39;happiness_hour&#39;: &#39;0&#39;,</span>
<span class="sd">                        &#39;ore_capacity&#39;: 0,</span>
<span class="sd">                        &#39;ore_hour&#39;: &#39;-3&#39;,</span>
<span class="sd">                        &#39;waste_capacity&#39;: 0,</span>
<span class="sd">                        &#39;waste_hour&#39;: &#39;5&#39;,</span>
<span class="sd">                        &#39;water_capacity&#39;: 0,</span>
<span class="sd">                        &#39;water_hour&#39;: &#39;31&#39;</span>
<span class="sd">                    },</span>
<span class="sd">                    &#39;url&#39;: &#39;/waterpurification&#39;</span>
<span class="sd">                },</span>
<span class="sd">                { another building dict },</span>
<span class="sd">                etc</span>
<span class="sd">            ]</span>

<span class="sd">        Raises ServerError 1009 if the passed coords are illegal for any reason (already </span>
<span class="sd">        occupied, out-of-bounds, etc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@lacuna.bc.LacunaObject.call_body_meth</span></div>
    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<div class="viewcode-block" id="MyBody.rename"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.rename">[docs]</a>        <span class="sd">&quot;&quot;&quot; Renames the current planet.</span>

<span class="sd">        For whatever reason, this returns int 1 on success.  Not a dict (like </span>
<span class="sd">        every other method), just a bare int.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@lacuna.bc.LacunaObject.call_body_meth</span></div>
    <span class="k">def</span> <span class="nf">abandon</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
<div class="viewcode-block" id="MyBody.abandon"><a class="viewcode-back" href="../../body.html#lacuna.body.MyBody.abandon">[docs]</a>        <span class="sd">&quot;&quot;&quot; Abandons the current planet. &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Planet</span><span class="p">(</span><span class="n">lacuna</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">SubClass</span><span class="p">):</span></div></div>
<div class="viewcode-block" id="Planet"><a class="viewcode-back" href="../../body.html#lacuna.body.Planet">[docs]</a>    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        id                  &quot;id-goes-here&quot;,</span>
<span class="sd">        x                   -4,</span>
<span class="sd">        y                    10,</span>
<span class="sd">        z                   6,</span>
<span class="sd">        star_id             &quot;id-goes-here&quot;,</span>
<span class="sd">        orbit               3,</span>
<span class="sd">        type                &quot;habitable planet&quot;,</span>
<span class="sd">        name                &quot;Earth&quot;,</span>
<span class="sd">        image               &quot;p13&quot;,</span>
<span class="sd">        size                67,</span>
<span class="sd">        water               900,</span>
<span class="sd">        ore                 {</span>
<span class="sd">                                &quot;gold&quot; : 3399,</span>
<span class="sd">                                &quot;bauxite&quot; : 4000,</span>
<span class="sd">                                etc,</span>
<span class="sd">                            },</span>
<span class="sd">        building_count      7,</span>
<span class="sd">        population          470000,</span>
<span class="sd">        happiness           3939,</span>
<span class="sd">        happiness_hour      25,</span>
<span class="sd">        food_stored         33329,</span>
<span class="sd">        food_capacity       40000,</span>
<span class="sd">        food_hour           229,</span>
<span class="sd">        energy_stored       39931,</span>
<span class="sd">        energy_capacity     43000,</span>
<span class="sd">        energy_hour         391,</span>
<span class="sd">        ore_hour            284,</span>
<span class="sd">        ore_capacity        35000,</span>
<span class="sd">        ore_stored          1901,</span>
<span class="sd">        waste_hour          933,</span>
<span class="sd">        waste_stored        9933,</span>
<span class="sd">        waste_capacity      13000,</span>
<span class="sd">        water_stored        9929,</span>
<span class="sd">        water_hour          295,</span>
<span class="sd">        water_capacity      51050</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Monty Lacuna 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jonathan Barton.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>