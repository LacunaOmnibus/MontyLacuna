

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating Script Tests &mdash; Monty Lacuna 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../static/monty_foot.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Monty Lacuna 0.1 documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> Monty Lacuna</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_running.html">Getting Started Running Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_running.html#overview-of-steps">Overview of Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_running.html#install-python-3">Install Python 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_running.html#install-montylacuna">Install MontyLacuna</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_running.html#install-pip-and-prerequisite-libraries">Install pip and Prerequisite Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_running.html#create-a-config-file">Create A Config File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_running.html#ready-to-test">Ready to Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/index.html">MontyLacuna Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#starter-scripts">Starter Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#regular-scripts">Regular Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config_file.html">Config File</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config_file.html#setting-descriptions">Setting Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_file.html#default-values">Default Values</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_writing.html">Getting Started Writing Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#tell-your-script-where-montylacuna-lives">Tell Your Script Where MontyLacuna Lives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#connect-a-client">Connect a client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#logging-and-caching">Logging and Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#debugging-requests">Debugging Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#method-calling">Method Calling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#test-scripts">Test Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#adding-unit-tests">Adding Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started_writing.html#example-snippets">Example Snippets</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tle_modules/index.html">TLE Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/alliance.html">Alliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/body.html">Body</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/building.html">Building</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/captcha.html">Captcha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/empire.html">Empire</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/inbox.html">Inbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/map.html">Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tle_modules/stats.html">Stats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Unit Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#existing-tests">Existing tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-all-tests">Running all tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-script-tests">Creating script tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bc.html">bc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../caching.html">caching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../caching.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caching.html#synopsis">Synopsis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caching.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caching.html#script-conventions">Script Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../caching.html#module-lacuna.clients">Module Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../clients.html">clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exceptions.html">exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glyph.html">glyph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../logging.html#log-levels">Log Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html#request-log">Request Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html#user-log">User Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html#module-log">Module Log</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../my_validate_email.html">my_validate_email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plan.html">plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recycling.html">recycling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource.html">resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ship.html">ship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spy.html">spy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trading.html">trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../types.html">types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../types.html#ship-translations">Ship Translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../types.html#ore-translations">Ore Translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../types.html#spy-assignment-translations">Spy Assignment Translations</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Monty Lacuna</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Creating Script Tests</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../sources/tests/creating_script_tests.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="creating-script-tests">
<span id="id1"></span><h1>Creating Script Tests<a class="headerlink" href="#creating-script-tests" title="Permalink to this headline">Â¶</a></h1>
<p>If you create a new MontyLacuna script, you may well want to (&#8220;you are
encouraged to&#8221;) add a test suite to go along with the script, to safeguard
against regressions.</p>
<p>The instructions here assume that your script follows the conventions used by
the existing MontyLacuna scripts:</p>
<blockquote>
<div><ul class="simple">
<li>Your script imports a library that implements a class that does most of
the heavy lifting</li>
<li>Your library inherits from <a class="reference internal" href="../getting_started_writing.html#lacuna.binutils.libbin.Script" title="lacuna.binutils.libbin.Script"><code class="xref py py-class docutils literal"><span class="pre">lacuna.binutils.libbin.Script</span></code></a></li>
</ul>
</div></blockquote>
<p>The problem with testing MontyLacuna scripts is that most of these scripts
expect arguments to be passed along on the command line, and your test scripts
won&#8217;t be doing that.  So we&#8217;ll need to make some minor code changes to allow
your test suite to work without passing arguments at the command line.</p>
<div class="section" id="modify-your-library">
<h2>Modify your library<a class="headerlink" href="#modify-your-library" title="Permalink to this headline">Â¶</a></h2>
<p>Your library will need to accept an optional argument, which is a dict named
<code class="docutils literal"><span class="pre">testargs</span></code>, and then pass that dict along to the call to your library&#8217;s
parent&#8217;s constructor:</p>
<div class="highlight-python"><div class="highlight"><pre>def __init__( self, testargs:dict = {} ):
...
super().__init__( parser, testargs = testargs )
</pre></div>
</div>
<p>If you initially created your script and library by copying one of the
existing MontyLacuna scripts and editing it to suit your needs, there&#8217;s a good
chance that code is already there.</p>
</div>
<div class="section" id="set-up-your-test-suite">
<h2>Set up your test suite<a class="headerlink" href="#set-up-your-test-suite" title="Permalink to this headline">Â¶</a></h2>
<p>Again, you&#8217;ll probably be better off copying one of the existing script test
suites and modifying it for your own use.  These modules live in
<code class="docutils literal"><span class="pre">ROOT/lib/lacuna/test/test_SCRIPTNAME.py</span></code>.</p>
<div class="section" id="connect-to-tle">
<h3>Connect to TLE<a class="headerlink" href="#connect-to-tle" title="Permalink to this headline">Â¶</a></h3>
<p>Your test class will need to inherit from both <code class="docutils literal"><span class="pre">unittest.TestCase</span></code> and
<code class="docutils literal"><span class="pre">lacuna.test.connector.Connector</span></code>.  My tests usually import
<code class="docutils literal"><span class="pre">lacuna.test.connector</span></code> as simply <code class="docutils literal"><span class="pre">conn</span></code> to save a little typing.</p>
<p>Create a <code class="docutils literal"><span class="pre">setUpClass()</span></code> method to connect for you:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyTestClass</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">conn</span><span class="o">.</span><span class="n">Connector</span> <span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tle_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">setUpClass()</span></code> will be run once when your test suite begins, and will
create <code class="docutils literal"><span class="pre">self.test_sitter</span></code> and <code class="docutils literal"><span class="pre">self.test_real</span></code> connection objects.</p>
</div>
<div class="section" id="instantiate-your-script-s-main-object">
<h3>Instantiate your script&#8217;s main object<a class="headerlink" href="#instantiate-your-script-s-main-object" title="Permalink to this headline">Â¶</a></h3>
<p>Your test will need to construct an object from your script&#8217;s library&#8217;s class,
and pass along whatever command-line arguments it wants to test out.</p>
<p>For example - to test out the <code class="docutils literal"><span class="pre">excavs_report.py</span></code> script, I need to set up a
dict containing the command line arguments that script is expecting, and then
pass along that dict to the constructor.  You need to pass along all arguments
that the script allows, and also pass along the client you&#8217;re using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;client&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitter</span><span class="p">,</span>
    <span class="s">&#39;fresh&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>              <span class="c"># don&#39;t want to be reading from and old</span>
                                <span class="c"># cache for tests.</span>
    <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitter</span><span class="o">.</span><span class="n">planet</span>  <span class="c"># more on this below</span>
<span class="p">}</span>
<span class="bp">self</span><span class="o">.</span><span class="n">er</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">ExcavsReport</span><span class="p">(</span> <span class="n">testargs</span> <span class="o">=</span> <span class="n">args</span> <span class="p">)</span>
</pre></div>
</div>
<p>At this point, <code class="docutils literal"><span class="pre">self.er</span></code> is an ExcavsReport object that we can happily test
against.  Your tests can create multiple ExcavsReport (or whatever) objects
with different faked-up command-line arguments so you can test all the
argument combinations you wish.</p>
</div>
</div>
<div class="section" id="edit-your-config-file">
<h2>Edit your config file<a class="headerlink" href="#edit-your-config-file" title="Permalink to this headline">Â¶</a></h2>
<p>Test scripts are going to create two TLE connections; one logged in with a
sitter password and one logged in with a real password.  These connections
assume that your config file contains the sections <code class="docutils literal"><span class="pre">test_sitter</span></code> and
<code class="docutils literal"><span class="pre">test_real</span></code>.</p>
<p>You&#8217;ll need to add those two sections to your config file.  <strong>Make sure that
both of these sections are connecting to your PT account rather than your US1
account!</strong></p>
</div>
<div class="section" id="empire-specific-testing">
<h2>Empire-specific testing<a class="headerlink" href="#empire-specific-testing" title="Permalink to this headline">Â¶</a></h2>
<p>There&#8217;s no way around it; some tests are going to require information about a
specific empire.  The best way to deal with this is going to be by editing the
config file, instead of having to edit each specific test script.</p>
<p>So, if your test script needs to work as sitter against a specific planet, eg
<code class="docutils literal"><span class="pre">Earth</span></code>, you can add a <code class="docutils literal"><span class="pre">planet</span></code> setting to your config file&#8217;s
<code class="docutils literal"><span class="pre">test_sitter</span></code> section:</p>
<div class="highlight-python"><div class="highlight"><pre>planet: Earth
</pre></div>
</div>
<p>In your test script, there&#8217;s an attribute named <code class="docutils literal"><span class="pre">sitter</span></code> that&#8217;s an object
representing your sitter login.  That object now has an attribute named
<code class="docutils literal"><span class="pre">planet</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitter</span><span class="o">.</span><span class="n">planet</span> <span class="p">)</span> <span class="c"># Earth</span>
</pre></div>
</div>
<p>Different tests will have different config file requirements; you&#8217;ll need to
check the documentation for each individual test to see all of the config file
edits you&#8217;ll need to make.</p>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014 - 2015, Jonathan Barton.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../static/jquery.js"></script>
      <script type="text/javascript" src="../static/underscore.js"></script>
      <script type="text/javascript" src="../static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>